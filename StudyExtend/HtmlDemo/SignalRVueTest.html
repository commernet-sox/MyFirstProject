<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SignalRVue</title>
    <!--微软SignalR js 客户端 必须要 -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/microsoft-signalr/3.1.3/signalr.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vue@2/dist/vue.js"></script>
</head>
<body>
    <div id="app">
        <div class="view">
            <div><textarea  v-model="sendValue" rows=3 placeholder="请输入要发送的内容"></textarea></div>
            <div><input type="text" v-model="name" placeholder="输入名称" /></div>
            <div>
                <button color="primary" @click="send">发送消息</button>
            </div>
        </div>
    </div>
</body>
<script>
    new Vue({
        el: "#app",
        data: {
            signalR: null,
            name: "MissLiu",
            sendValue: "其实AspNetCore.SignalR 非常简单"
        },
        methods: {
            initSignalR() {
                var _this = this;
                _this.signalR = new signalR.HubConnectionBuilder()
                    .withUrl("https://localhost:7162/ChatHub")
                    .configureLogging(signalR.LogLevel.Information)
                    .build();

                try {
                    _this.signalR.start();
                } catch (err) {
                    console.log(err);
                }
                //监听连接成功
                _this.signalR.on("Connected", (message) => {
                    console.log(message)
                });

                _this.signalR.on("ReceiveMessage", (user, message) => {
                    console.log({
                        type: "info",
                        title: user + " 说 ",
                        content: message
                    });
                });
            },
            send() {

                this.signalR.invoke("SendMessage", this.name, this.sendValue).catch(function(err) {
                    return console.error(err.toString());
                });
            }
        },
        mounted() {
            this.initSignalR();
        },
    });
</script>
</html>